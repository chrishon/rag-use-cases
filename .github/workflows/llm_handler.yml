name: Zip the LLM function

on:
  push:
    paths:
      - bedrock-rag/bedrock_rag/resources/llm_function/**
      - .github/workflows/llm_handler.yml

jobs:
  package:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v3
      with:
        python-version: '3.8' # Specify the Python version you need

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip

    - name: Package dependencies
      run: |
        cd bedrock-rag/bedrock_rag/resources/llm_function
        mkdir temp
        pip install --target temp/ -r requirements.txt
        cp llm_handler.py temp/
        cd temp
        zip -r llm_handler.zip .
        cp llm_handler.zip ../

    - name: Upload the package as an artifact
      uses: actions/upload-artifact@v2
      with:
        name: llm_handler.zip
        path: bedrock-rag/bedrock_rag/resources/

    - name: Clean up
      run: rm -rf package
